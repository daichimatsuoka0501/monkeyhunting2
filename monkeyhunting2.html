<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Monkey Hunting</title>
  <!-- GlowScriptの必要なCSS -->
  <link rel="stylesheet" href="https://www.glowscript.org/css/redmond/2.1/jquery-ui.custom.css">
  <link rel="stylesheet" href="https://www.glowscript.org/css/ide.css">
  <!-- GlowScriptの必要なJavaScript -->
  <script src="https://www.glowscript.org/lib/jquery/2.1/jquery.min.js"></script>
  <script src="https://www.glowscript.org/lib/jquery/2.1/jquery-ui.custom.min.js"></script>
  <script src="https://www.glowscript.org/package/glow.3.2.min.js"></script>
  <script src="https://www.glowscript.org/package/RSrun.3.2.min.js"></script>
</head>
<body>
  <!-- シミュレーションが表示されるエリア -->
  <div id="glowscript" class="glowscript"></div>

  <!-- JavaScriptコード -->
  <script>
    // GlowScriptの設定とスクリプト開始
    ;(function() {
      "use strict";
      var scene = canvas({center: vec(10, 10, 0), width: 800, height: 800, range: 20});

      var g = 9.8; // 重力加速度
      var h = 0.005; // 時間刻み
      var v0 = 20; // 初速度
      var theta = 30 * Math.PI / 180; // 発射角度（ラジアン）
      var L = 20; // モンキーの位置
      var running = false; // シミュレーション状態
      var t = 0;

      // ボールとモンキーの設定
      var ball1 = sphere({pos: vec(0, 0, 0), radius: 0.5, color: color.red, make_trail: true});
      var ball2 = sphere({pos: vec(L, L * Math.tan(theta), 0), radius: 0.5, color: color.blue});

      // ボールとモンキーの初速度
      ball1.vel = vec(v0 * Math.cos(theta), v0 * Math.sin(theta), 0);
      ball2.vel = vec(0, 0, 0);

      // シミュレーションのメインループ
      async function simulate() {
        while (true) {
          await rate(100);
          if (running) {
            ball1.pos = ball1.pos.add(ball1.vel.multiply(h));
            ball1.vel = ball1.vel.add(vec(0, -g * h, 0));
            t += h;

            // ボールが地面に到達したら停止
            if (ball1.pos.y <= 0) {
              running = false;
              console.log("Simulation ended at t =", t.toFixed(2), "s");
            }

            // ボールとモンキーが接触したら停止
            if (mag(ball1.pos.subtract(ball2.pos)) < 0.5) {
              running = false;
              console.log("Hit! at t =", t.toFixed(2), "s");
            }
          }
        }
      }

      // 実行ボタン
      button({
        text: "Run",
        bind: function() {
          running = !running;
        }
      });

      // シミュレーション開始
      simulate();
    })();
  </script>
</body>
</html>
