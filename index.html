<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Monkey Hunting Simulation</title>
  <!-- GlowScriptのリソース -->
  <link type="text/css" href="https://www.glowscript.org/css/redmond/2.1/jquery-ui.custom.css" rel="stylesheet" />
  <link type="text/css" href="https://www.glowscript.org/css/ide.css" rel="stylesheet" />
  <script type="text/javascript" src="https://www.glowscript.org/lib/jquery/2.1/jquery.min.js"></script>
  <script type="text/javascript" src="https://www.glowscript.org/lib/jquery/2.1/jquery-ui.custom.min.js"></script>
  <script type="text/javascript" src="https://www.glowscript.org/package/glow.3.2.min.js"></script>
  <script type="text/javascript" src="https://www.glowscript.org/package/RSrun.3.2.min.js"></script>
</head>
<body>
  <div id="glowscript" class="glowscript"></div>
  <script>
    // 初期化: 必須
    window.__context = { glowscript_container: "glowscript" };

    // JavaScriptコードのスタート
    (async function() {
      "use strict";

      var scene = canvas({center: vec(10, 10, 0), width: 800, height: 800, range: 20});
      var g = 9.8; // 重力加速度
      var h = 0.005; // 時間の刻み
      var v0 = 20; // 初速度
      var theta = 30 * Math.PI / 180; // 初期角度
      var running = false; // 実行状態
      var reset_flag = false; // リセットフラグ
      var t = 0; // 時間
      var L = 20; // 初期の位置

      // ボールの定義
      var ball1 = sphere({pos: vec(0, 0, 0), radius: 0.5, color: color.red, make_trail: true, trail_type: "points", interval: 10, retain: 100});
      var ball2 = sphere({radius: 0.5, color: color.blue, make_trail: true, trail_type: "points", interval: 10, retain: 100});

      // スライダーやボタンなど、インターフェース設定を続けて記述...

      async function animate() {
        rate(100);

        if (reset_flag) {
          reset_simulation();
          reset_flag = false;
        }

        if (running) {
          ball1.pos = ball1.pos.add(ball1.vel.multiply(h));
          ball1.vel = ball1.vel.add(vec(0, -g * h, 0));
          t += h;

          // 衝突検知などをここで実装...
        }
      }

      async function reset_simulation() {
        ball1.pos = vec(0, 0, 0);
        ball2.pos = vec(L, L * Math.tan(theta), 0);
        ball1.vel = vec(v0 * Math.cos(theta), v0 * Math.sin(theta), 0);
        ball2.vel = vec(0, 0, 0);
        ball1.clear_trail();
        ball2.clear_trail();
        t = 0;
      }

      while (true) {
        await animate();
      }
    })();
  </script>
</body>
</html>
